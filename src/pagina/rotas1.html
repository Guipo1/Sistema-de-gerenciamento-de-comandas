<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Sistema de Comandas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .chart-container {
        position: relative;
        height: 400px;
        width: 100%;
      }
      .stat-card {
        transition: all 0.3s ease;
      }
      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="bg-blue-600 text-white shadow-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <img
                src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/98585f3a-7026-4fc2-afd8-a7e904572269.png"
                alt="Logo do restaurante com design moderno em branco sobre fundo transparente"
                class="h-8 w-8"
              />
            </div>
            <div class="ml-3 text-xl font-bold">Sistema de Comandas</div>
          </div>
          <div class="flex space-x-4">
            <a
              onclick="redirecionar('/admin')"
              class="px-3 py-2 rounded-md text-sm font-medium bg-blue-700 hover:bg-blue-800 transition duration-300"
            >
              Gerenciar Comandas
            </a>
            <a
              onclick="redirecionar('/alterar')"
              class="px-3 py-2 rounded-md text-sm font-medium bg-green-600 hover:bg-green-700 transition duration-300"
            >
              Alterar Cardápio
            </a>
          </div>
        </div>
      </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <!-- Título e informações -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">
          Dashboard Financeiro
        </h1>
        <p class="text-gray-600">
          Acompanhe os principais indicadores do seu negócio
        </p>
      </div>

      <!-- Cards de Estatísticas -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div
          class="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500"
        >
          <h3 class="text-gray-500 text-sm font-medium">Total Semanal</h3>
          <p class="text-2xl font-bold text-gray-800">R$ 8.742,50</p>
          <p class="text-green-600 text-sm mt-1">
            +12% em relação à semana passada
          </p>
        </div>
        <div
          class="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-green-500"
        >
          <h3 class="text-gray-500 text-sm font-medium">Comandas Hoje</h3>
          <p class="text-2xl font-bold text-gray-800">23</p>
          <p class="text-blue-600 text-sm mt-1">+3 em relação a ontem</p>
        </div>
        <div
          class="stat-card bg-white p-6 rounded-lg shadow-md border-l-4 border-purple-500"
        >
          <h3 class="text-gray-500 text-sm font-medium">Ticket Médio</h3>
          <p class="text-2xl font-bold text-gray-800">R$ 68,90</p>
          <p class="text-yellow-600 text-sm mt-1">
            +5% em relação ao mês passado
          </p>
        </div>
      </div>

      <!-- Gráficos -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Gráfico de Lucro Diário -->
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">
            Lucro Diário (R$)
          </h2>
          <div class="chart-container">
            <canvas id="profitChart"></canvas>
          </div>
        </div>

        <!-- Gráfico de Quantidade de Comandas -->
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h2 class="text-xl font-semibold text-gray-800 mb-4">
            Quantidade de Comandas
          </h2>
          <div class="chart-container">
            <canvas id="ordersChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Rodapé -->
      <div class="mt-8 text-center text-gray-500 text-sm">
        <p>Atualizado em <span id="currentDate"></span></p>
      </div>
    </div>

    <script>
      // Dados hipotéticos simulando resposta do servidor
      const dates = [];
      const today = new Date();
      const token = localStorage.getItem("token");
      const nomeEstabelecimento = localStorage.getItem("nomeEstabelecimento");
      function redirecionar(rota) {
        if (rota === "/admin") {
          window.location.href = `${rota}/${token}`;
        } else {
          window.location.href = `${rota}/${token}/${nomeEstabelecimento}`;
        }
      }
      //rederizar dados
      fetch(`/dadospainel/${token}`, { method: "GET" })
        .then((response) => response.json())
        .then((data) => {});
      //
      // Gerar datas dos últimos 7 dias
      for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        dates.push(date.toLocaleDateString("pt-BR"));
      }

      // Valores hipotéticos para as comandas
      const dailyProfit = [1120, 980, 1450, 1320, 1680, 1930, 1560];
      const dailyOrders = [18, 15, 22, 19, 26, 29, 60];

      // Formatando data atual para exibição no rodapé
      document.getElementById("currentDate").textContent =
        today.toLocaleDateString("pt-BR", {
          day: "2-digit",
          month: "long",
          year: "numeric",
        });

      // Configuração do gráfico de lucro
      const profitCtx = document.getElementById("profitChart").getContext("2d");
      const profitChart = new Chart(profitCtx, {
        type: "bar",
        data: {
          labels: dates,
          datasets: [
            {
              label: "Lucro em R$",
              data: dailyProfit,
              backgroundColor: "rgba(59, 130, 246, 0.6)",
              borderColor: "rgba(59, 130, 246, 1)",
              borderWidth: 1,
              borderRadius: 4,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "top",
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  return `R$ ${context.raw.toFixed(2).replace(".", ",")}`;
                },
              },
            },
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function (value) {
                  return `R$ ${value}`;
                },
              },
            },
          },
        },
      });

      // Configuração do gráfico de quantidade de comandas
      const ordersCtx = document.getElementById("ordersChart").getContext("2d");
      const ordersChart = new Chart(ordersCtx, {
        type: "line",
        data: {
          labels: dates,
          datasets: [
            {
              label: "Número de Comandas",
              data: dailyOrders,
              backgroundColor: "rgba(16, 185, 129, 0.2)",
              borderColor: "rgba(16, 185, 129, 1)",
              borderWidth: 2,
              tension: 0.3,
              fill: true,
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: "top",
            },
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                precision: 0,
              },
            },
          },
        },
      });
    </script>
  </body>
</html>
